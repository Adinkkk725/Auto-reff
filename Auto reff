const fs = require('fs');
const crypto = require('crypto');
const axios = require('axios');

// Fungsi untuk membuat wallet baru (Dummy)
function generateWallet() {
    const walletAddress = '0x' + crypto.randomBytes(20).toString('hex');
    const privateKey = crypto.randomBytes(32).toString('hex');
    return { walletAddress, privateKey };
}

// Fungsi untuk daftar referral otomatis
async function registerReferral(walletAddress, referralCode) {
    try {
        const response = await axios.post('https://quest-api.arenavs.com/api/v1/users/initialize', {
            walletAddress: walletAddress,
            referralCode: referralCode
        });

        if (response.data.user) {
            console.log(`✅ Wallet ${walletAddress} berhasil daftar referral!`);
            return response.data;
        } else {
            console.log(`❌ Gagal daftar:`, response.data);
        }
    } catch (error) {
        console.log(`❌ Error:`, error.response ? error.response.data : error.message);
    }
}

// Fungsi utama
async function main() {
    const referralCode = "X14PSQWN"; // Ganti dengan referral code kamu

    console.log("🔄 Membuat wallet baru...");
    const newWallet = generateWallet();

    console.log("📝 Menyimpan wallet ke file...");
    fs.appendFileSync("wallets.txt", `${newWallet.walletAddress} | ${newWallet.privateKey}\n`);

    console.log("🚀 Mendaftar referral...");
    await registerReferral(newWallet.walletAddress, referralCode);
}

main();
